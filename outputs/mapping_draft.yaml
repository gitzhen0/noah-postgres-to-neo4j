metadata:
  version: '2.0'
  description: Auto-generated by SchemaInterpreter
  generated_at: 2026-02-20 18:34
  database: noah_housing
spatial:
  preserve_wkt: false
  preserve_geojson: false
  compute_centroids: true
  compute_metrics: false
  compute_bbox: false
  use_neo4j_point: true
  neighbors_threshold_km: 5.0
nodes:
- label: HousingProject
  source_table: housing_projects
  primary_property: db_id
  has_geometry: true
  merge_keys:
  - db_id
  indexes:
  - project_id
  - postcode
  - census_tract
  - borough
  properties:
  - name: db_id
    type: integer
    nullable: false
    source_column: id
    source_type: integer
  - name: one_br_units
    type: integer
    nullable: true
    source_column: _1_br_units
    source_type: integer
  - name: two_br_units
    type: integer
    nullable: true
    source_column: _2_br_units
    source_type: integer
  - name: three_br_units
    type: integer
    nullable: true
    source_column: _3_br_units
    source_type: integer
  - name: four_br_units
    type: integer
    nullable: true
    source_column: _4_br_units
    source_type: integer
  - name: five_br_units
    type: integer
    nullable: true
    source_column: _5_br_units
    source_type: integer
  - name: six_br_units
    type: integer
    nullable: true
    source_column: _6_br_units
    source_type: integer
  - name: project_id
    type: string
    nullable: false
    source_column: project_id
    source_type: character varying
  - name: project_name
    type: string
    nullable: true
    source_column: project_name
    source_type: text
  - name: building_id
    type: string
    nullable: true
    source_column: building_id
    source_type: character varying
  - name: house_number
    type: string
    nullable: true
    source_column: house_number
    source_type: character varying
  - name: street_name
    type: string
    nullable: true
    source_column: street_name
    source_type: character varying
  - name: borough
    type: string
    nullable: true
    source_column: borough
    source_type: character varying
  - name: postcode
    type: string
    nullable: true
    source_column: postcode
    source_type: character varying
  - name: bbl
    type: string
    nullable: true
    source_column: bbl
    source_type: character varying
  - name: bin
    type: string
    nullable: true
    source_column: bin
    source_type: character varying
  - name: community_board
    type: string
    nullable: true
    source_column: community_board
    source_type: character varying
  - name: council_district
    type: integer
    nullable: true
    source_column: council_district
    source_type: integer
  - name: census_tract
    type: string
    nullable: true
    source_column: census_tract
    source_type: character varying
  - name: neighborhood_tabulation_area
    type: string
    nullable: true
    source_column: neighborhood_tabulation_area
    source_type: character varying
  - name: project_start_date
    type: date
    nullable: true
    source_column: project_start_date
    source_type: date
  - name: project_completion_date
    type: date
    nullable: true
    source_column: project_completion_date
    source_type: date
  - name: building_completion_date
    type: date
    nullable: true
    source_column: building_completion_date
    source_type: date
  - name: reporting_construction_type
    type: string
    nullable: true
    source_column: reporting_construction_type
    source_type: character varying
  - name: extended_affordability_status
    type: string
    nullable: true
    source_column: extended_affordability_status
    source_type: character varying
  - name: prevailing_wage_status
    type: string
    nullable: true
    source_column: prevailing_wage_status
    source_type: character varying
  - name: extremely_low_income_units
    type: integer
    nullable: true
    source_column: extremely_low_income_units
    source_type: integer
  - name: very_low_income_units
    type: integer
    nullable: true
    source_column: very_low_income_units
    source_type: integer
  - name: low_income_units
    type: integer
    nullable: true
    source_column: low_income_units
    source_type: integer
  - name: moderate_income_units
    type: integer
    nullable: true
    source_column: moderate_income_units
    source_type: integer
  - name: middle_income_units
    type: integer
    nullable: true
    source_column: middle_income_units
    source_type: integer
  - name: other_income_units
    type: integer
    nullable: true
    source_column: other_income_units
    source_type: integer
  - name: studio_units
    type: integer
    nullable: true
    source_column: studio_units
    source_type: integer
  - name: unknown_br_units
    type: integer
    nullable: true
    source_column: unknown_br_units
    source_type: integer
  - name: counted_rental_units
    type: integer
    nullable: true
    source_column: counted_rental_units
    source_type: integer
  - name: counted_homeownership_units
    type: integer
    nullable: true
    source_column: counted_homeownership_units
    source_type: integer
  - name: all_counted_units
    type: integer
    nullable: true
    source_column: all_counted_units
    source_type: integer
  - name: total_units
    type: integer
    nullable: true
    source_column: total_units
    source_type: integer
  - name: data_source
    type: string
    nullable: true
    source_column: data_source
    source_type: character varying
  - name: center_lat
    type: float
    nullable: true
    source_column: geom
    transformation: ST_Y(ST_Centroid(geom))
  - name: center_lon
    type: float
    nullable: true
    source_column: geom
    transformation: ST_X(ST_Centroid(geom))
  - name: area_km2
    type: float
    nullable: true
    source_column: geom
    transformation: ST_Area(geom::geography) / 1000000.0
  geometry_column: geom
- label: ZipCode
  source_table: zip_shapes
  primary_property: zip_code
  has_geometry: true
  merge_keys:
  - zip_code
  indexes:
  - borough
  properties:
  - name: zip_code
    type: string
    nullable: false
    source_column: zip_code
    source_type: character varying
  - name: borough
    type: string
    nullable: true
    source_column: borough
    source_type: character varying
  - name: center_lat
    type: float
    nullable: true
    source_column: geom
    transformation: ST_Y(ST_Centroid(geom))
  - name: center_lon
    type: float
    nullable: true
    source_column: geom
    transformation: ST_X(ST_Centroid(geom))
  - name: area_km2
    type: float
    nullable: true
    source_column: geom
    transformation: ST_Area(geom::geography) / 1000000.0
  geometry_column: geom
- label: AffordabilityAnalysis
  source_table: noah_affordability_analysis
  primary_property: zip_code
  has_geometry: false
  merge_keys:
  - zip_code
  indexes: []
  properties:
  - name: zip_code
    type: string
    nullable: false
    source_column: zip_code
    source_type: character varying
  - name: median_income_usd
    type: float
    nullable: true
    source_column: median_income_usd
    source_type: numeric
  - name: rent_burden_rate
    type: float
    nullable: true
    source_column: rent_burden_rate
    source_type: numeric
  - name: severe_burden_rate
    type: float
    nullable: true
    source_column: severe_burden_rate
    source_type: numeric
  - name: median_rent_usd
    type: float
    nullable: true
    source_column: median_rent_usd
    source_type: numeric
  - name: rent_to_income_ratio
    type: float
    nullable: true
    source_column: rent_to_income_ratio
    source_type: numeric
- label: RentBurden
  source_table: rent_burden
  primary_property: geo_id
  has_geometry: true
  merge_keys:
  - geo_id
  indexes:
  - tract_name
  properties:
  - name: geo_id
    type: string
    nullable: false
    source_column: geo_id
    source_type: text
  - name: tract_name
    type: string
    nullable: true
    source_column: tract_name
    source_type: text
  - name: rent_burden_rate
    type: float
    nullable: true
    source_column: rent_burden_rate
    source_type: numeric
  - name: severe_burden_rate
    type: float
    nullable: true
    source_column: severe_burden_rate
    source_type: numeric
  - name: center_lat
    type: float
    nullable: true
    source_column: geometry
    transformation: ST_Y(ST_Centroid(geometry))
  - name: center_lon
    type: float
    nullable: true
    source_column: geometry
    transformation: ST_X(ST_Centroid(geometry))
  - name: area_km2
    type: float
    nullable: true
    source_column: geometry
    transformation: ST_Area(geometry::geography) / 1000000.0
  geometry_column: geometry
relationships:
- type: LOCATED_IN_ZIP
  from_label: HousingProject
  to_label: ZipCode
  source_type: foreign_key
  bidirectional: false
  source_table: housing_projects
  from_column: postcode
  to_column: postcode
  from_id_column: id
  to_id_column: postcode
  properties: []
- type: HAS_AFFORDABILITY_DATA
  from_label: ZipCode
  to_label: AffordabilityAnalysis
  source_type: foreign_key
  bidirectional: false
  source_table: noah_affordability_analysis
  from_column: zip_code
  to_column: zip_code
  from_id_column: zip_code
  to_id_column: zip_code
  properties: []
- type: IN_CENSUS_TRACT
  from_label: HousingProject
  to_label: RentBurden
  source_type: computed
  bidirectional: false
  computation_query: |
    SELECT
      h.id AS from_id,
      (CASE h.borough
        WHEN 'Manhattan'     THEN '36061'
        WHEN 'Bronx'         THEN '36005'
        WHEN 'Brooklyn'      THEN '36047'
        WHEN 'Queens'        THEN '36081'
        WHEN 'Staten Island' THEN '36085'
      END || LPAD(
        (CAST(h.census_tract AS numeric) * 100)::bigint::text,
        6, '0'
      )) AS to_id
    FROM housing_projects h
    JOIN rent_burden rb ON rb.geo_id = (
      CASE h.borough
        WHEN 'Manhattan'     THEN '36061'
        WHEN 'Bronx'         THEN '36005'
        WHEN 'Brooklyn'      THEN '36047'
        WHEN 'Queens'        THEN '36081'
        WHEN 'Staten Island' THEN '36085'
      END || LPAD(
        (CAST(h.census_tract AS numeric) * 100)::bigint::text,
        6, '0'
      ))
    WHERE h.census_tract IS NOT NULL
      AND h.census_tract <> ''
      AND h.census_tract ~ '^[0-9]+(\.[0-9]+)?$'
  properties: []
- type: NEIGHBORS
  from_label: ZipCode
  to_label: ZipCode
  source_type: spatial
  bidirectional: true
  computation_query: SELECT a.zip_code AS from_id, b.zip_code AS to_id, ST_Length(ST_Intersection(a.geom,
    b.geom)::geography) / 1000.0 AS shared_boundary_km, ST_Touches(a.geom, b.geom)
    AS is_touching FROM zip_shapes a JOIN zip_shapes b ON a.zip_code < b.zip_code
    AND (ST_Touches(a.geom, b.geom) OR ST_Intersects(a.geom, b.geom))
  properties:
  - name: shared_boundary_km
    type: float
    nullable: true
    source_column: shared_boundary_km
  - name: is_touching
    type: boolean
    nullable: true
    source_column: is_touching
- type: CONTAINS_TRACT
  from_label: ZipCode
  to_label: RentBurden
  source_type: spatial
  bidirectional: false
  computation_query: SELECT z.zip_code AS from_id, r.geo_id AS to_id, ST_Area(ST_Intersection(z.geom,
    r.geometry)::geography) / 1000000.0 AS overlap_area_km2, ST_Area(ST_Intersection(z.geom,
    r.geometry)::geography) / ST_Area(r.geometry::geography) AS tract_coverage_ratio
    FROM zip_shapes z JOIN rent_burden r ON ST_Intersects(z.geom, r.geometry) WHERE
    ST_Area(ST_Intersection(z.geom, r.geometry)::geography) > 0
  properties:
  - name: overlap_area_km2
    type: float
    nullable: true
    source_column: overlap_area_km2
  - name: tract_coverage_ratio
    type: float
    nullable: true
    source_column: tract_coverage_ratio
